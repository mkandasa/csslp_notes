<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSSLP Domain 2: Agile vs Waterfall Security</title>
    <style>
        :root {
            --bg: #1e1e2e;
            --panel: #2b2b3d;
            --text: #cdd6f4;
            --accent: #cba6f7; /* Violet */
            --waterfall: #89b4fa; /* Blue */
            --agile: #a6e3a1; /* Green */
            --danger: #f38ba8;
            --warn: #fab387;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 { border-bottom: 2px solid var(--accent); padding-bottom: 10px; margin-bottom: 20px; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn {
            background: var(--panel); color: #9399b2;
            border: 1px solid #45475a; padding: 10px 20px;
            cursor: pointer; border-radius: 6px;
            font-weight: bold; transition: all 0.2s;
        }
        .tab-btn.active { background: var(--accent); color: #1e1e2e; border-color: var(--accent); }
        .tab-btn:hover { background: #45475a; }
        
        .tab-content { display: none; width: 100%; max-width: 1000px; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: var(--panel); padding: 25px; border-radius: 12px;
            border: 1px solid #45475a; margin-bottom: 20px; position: relative;
        }
        .card h3 { margin-top: 0; color: var(--accent); border-bottom: 1px solid #45475a; padding-bottom: 10px; }

        button {
            padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer;
            font-weight: bold; transition: opacity 0.2s; margin-top: 10px;
        }
        button:hover { opacity: 0.9; }
        .btn-w { background: var(--waterfall); color: #1e1e2e; }
        .btn-a { background: var(--agile); color: #1e1e2e; }
        .btn-d { background: var(--danger); color: #1e1e2e; }

        /* --- Waterfall Styles --- */
        .phase-container { display: flex; justify-content: space-between; margin-top: 20px; position: relative; }
        .phase-container::before {
            content: ''; position: absolute; top: 25px; left: 0; right: 0; height: 4px;
            background: #45475a; z-index: 0;
        }
        .phase-node {
            width: 100px; text-align: center; position: relative; z-index: 1;
            opacity: 0.5; transition: all 0.3s;
        }
        .phase-circle {
            width: 50px; height: 50px; background: #313244; border: 4px solid #45475a;
            border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center;
            font-weight: bold; color: #fff;
        }
        .phase-node.active { opacity: 1; transform: scale(1.1); }
        .phase-node.active .phase-circle { border-color: var(--waterfall); background: #1e1e2e; box-shadow: 0 0 15px var(--waterfall); }
        .phase-node.completed .phase-circle { border-color: var(--agile); background: var(--agile); color: #000; }

        .cost-meter { 
            height: 20px; background: #111; border-radius: 10px; overflow: hidden; margin-top: 10px;
            border: 1px solid #45475a;
        }
        .cost-fill { height: 100%; width: 0%; background: var(--danger); transition: width 0.5s; }

        /* --- Agile Styles --- */
        .kanban-board { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; min-height: 300px; }
        .kanban-col { background: #181825; padding: 10px; border-radius: 8px; border: 1px solid #45475a; }
        .kanban-col h4 { text-align: center; margin: 0 0 10px 0; color: #a6adc8; }
        
        .story-card {
            background: #313244; padding: 10px; margin-bottom: 10px; border-radius: 4px;
            border-left: 4px solid #aaa; cursor: pointer; user-select: none;
            transition: transform 0.2s; position: relative;
        }
        .story-card:hover { transform: translateY(-2px); background: #45475a; }
        .story-card.feature { border-left-color: var(--waterfall); }
        .story-card.security { border-left-color: var(--agile); }
        .story-card.debt { border-left-color: var(--danger); }
        
        .points-badge { 
            position: absolute; right: 10px; top: 10px; 
            background: #111; padding: 2px 6px; border-radius: 10px; font-size: 0.7rem; 
        }

        /* --- Log --- */
        .log-terminal {
            grid-column: span 2; background: #111; height: 120px; 
            padding: 10px; overflow-y: auto; font-family: monospace; 
            border: 1px solid #45475a; color: #cdd6f4; font-size: 0.9rem; margin-top: 20px;
        }
        .log-err { color: var(--danger); }
        .log-success { color: var(--agile); }

    </style>
</head>
<body>

    <h1>CSSLP: Agile vs. Waterfall Simulator</h1>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('waterfall')">1. Waterfall (Cost of Change)</button>
        <button class="tab-btn" onclick="switchTab('agile')">2. Agile (Sprint Balance)</button>
    </div>

    <!-- TAB 1: WATERFALL -->
    <div id="waterfall" class="tab-content active">
        <div class="card">
            <h3>Waterfall Project: "Banking Core v1.0"</h3>
            <p>You must complete each phase. You have a choice: <strong>Invest in Security</strong> now (Slows you down) or <strong>Skip it</strong> (Speeds you up).</p>
            
            <div class="phase-container">
                <div class="phase-node active" id="p1">
                    <div class="phase-circle">1</div>
                    <div>Reqs</div>
                </div>
                <div class="phase-node" id="p2">
                    <div class="phase-circle">2</div>
                    <div>Design</div>
                </div>
                <div class="phase-node" id="p3">
                    <div class="phase-circle">3</div>
                    <div>Code</div>
                </div>
                <div class="phase-node" id="p4">
                    <div class="phase-circle">4</div>
                    <div>Test</div>
                </div>
                <div class="phase-node" id="p5">
                    <div class="phase-circle">5</div>
                    <div>Prod</div>
                </div>
            </div>

            <div style="margin-top: 30px; text-align: center;">
                <h4 id="currentPhaseTitle">Phase 1: Requirements</h4>
                <div id="decisionBox">
                    <button class="btn-w" onclick="waterfallAction('secure')">üõ°Ô∏è Review Security Reqs (Cost: $500)</button>
                    <button class="btn-d" onclick="waterfallAction('skip')">‚è© Skip Review (Cost: $0)</button>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <div style="display:flex; justify-content:space-between">
                    <span>Project Cost: <strong id="wfCost">$0</strong></span>
                    <span>Hidden Bugs: <strong id="wfBugs" style="color:var(--danger)">0</strong></span>
                </div>
                <div class="cost-meter"><div class="cost-fill" id="wfMeter"></div></div>
            </div>
        </div>
    </div>

    <!-- TAB 2: AGILE -->
    <div id="agile" class="tab-content">
        <div class="card">
            <h3>Agile Sprint Board</h3>
            <p><strong>Goal:</strong> Fill the Sprint (Capacity: 10 pts). Balance Features (Business Value) with Security (Risk Reduction). Click cards to move them.</p>
            
            <div style="display:flex; justify-content:space-between; margin-bottom:10px; background:#181825; padding:10px; border-radius:6px;">
                <span>Sprint Capacity: <strong id="sprintCap">0 / 10</strong></span>
                <span>Risk Level: <strong id="riskLevel" style="color:var(--agile)">LOW</strong></span>
                <button class="btn-a" style="margin:0; padding:5px 10px;" onclick="runSprint()">üöÄ Run Sprint</button>
            </div>

            <div class="kanban-board">
                <!-- Backlog -->
                <div class="kanban-col" id="col-backlog">
                    <h4>Backlog</h4>
                    <div class="story-card feature" onclick="moveCard(this)" data-pts="5" data-type="feat">
                        <strong>New Payment UI</strong>
                        <div class="points-badge">5 pts</div>
                        <div style="font-size:0.8rem; color:#aaa">Business Value: High</div>
                    </div>
                    <div class="story-card feature" onclick="moveCard(this)" data-pts="3" data-type="feat">
                        <strong>User Profile Pic</strong>
                        <div class="points-badge">3 pts</div>
                        <div style="font-size:0.8rem; color:#aaa">Business Value: Med</div>
                    </div>
                    <div class="story-card security" onclick="moveCard(this)" data-pts="3" data-type="sec">
                        <strong>Implement MFA</strong>
                        <div class="points-badge">3 pts</div>
                        <div style="font-size:0.8rem; color:#aaa">Prevents Account Takeover</div>
                    </div>
                    <div class="story-card security" onclick="moveCard(this)" data-pts="2" data-type="sec">
                        <strong>Fix SQL Injection</strong>
                        <div class="points-badge">2 pts</div>
                        <div style="font-size:0.8rem; color:#aaa">Critical Vuln Patch</div>
                    </div>
                    <div class="story-card debt" onclick="moveCard(this)" data-pts="8" data-type="debt">
                        <strong>Refactor Auth Core</strong>
                        <div class="points-badge">8 pts</div>
                        <div style="font-size:0.8rem; color:#aaa">Technical Debt</div>
                    </div>
                </div>

                <!-- Sprint -->
                <div class="kanban-col" id="col-sprint">
                    <h4>Current Sprint</h4>
                    <!-- Droppable -->
                </div>

                <!-- Done -->
                <div class="kanban-col" id="col-done">
                    <h4>Done (Shipped)</h4>
                </div>
            </div>
        </div>
    </div>

    <!-- LOGS -->
    <div class="log-terminal" id="logs">
        <div>> Simulation Ready. Select a methodology.</div>
    </div>

    <script>
        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(d => d.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            const map = {'waterfall':0, 'agile':1};
            document.querySelectorAll('.tab-btn')[map[id]].classList.add('active');
        }

        function log(msg, type='info') {
            const term = document.getElementById('logs');
            const cls = type === 'err' ? 'log-err' : (type === 'success' ? 'log-success' : '');
            term.innerHTML += `<div class="${cls}">> ${msg}</div>`;
            term.scrollTop = term.scrollHeight;
        }

        /* --- WATERFALL LOGIC --- */
        let wfPhase = 1;
        let wfCost = 0;
        let wfBugs = 0;
        const phases = ["Requirements", "Design", "Code", "Test", "Production"];

        function waterfallAction(action) {
            // Apply costs/bugs based on current phase
            if (wfPhase === 1) { // Reqs
                if(action === 'secure') { wfCost += 500; log("Phase 1: Security Requirements defined. (Cost $500)"); }
                else { wfBugs++; log("Phase 1: Skipped Security. Saved money, but missed a requirement.", 'err'); }
            }
            else if (wfPhase === 2) { // Design
                if(action === 'secure') { wfCost += 1000; log("Phase 2: Threat Model complete. (Cost $1000)"); }
                else { wfBugs++; log("Phase 2: Skipped Threat Model. Architecture flaw introduced.", 'err'); }
            }
            else if (wfPhase === 3) { // Code
                if(action === 'secure') { wfCost += 2000; log("Phase 3: Secure Coding & Static Analysis. (Cost $2000)"); }
                else { wfBugs++; log("Phase 3: Rushed coding. Introduced XSS vulnerability.", 'err'); }
            }
            else if (wfPhase === 4) { // Test
                // Here we pay the price
                log("Phase 4: Running Pen Test...", 'warn');
                if (wfBugs > 0) {
                    const fixCost = wfBugs * 15000; // Expensive to fix now!
                    wfCost += fixCost;
                    log(`CRITICAL: Found ${wfBugs} major flaws! Rework required.`, 'err');
                    log(`Cost of Rework: $${fixCost} (Because we have to go back to Design)`, 'err');
                    wfBugs = 0; // Fixed
                } else {
                    log("Test Clean! No critical findings.", 'success');
                }
            }

            updateWaterfallUI();
            
            if(wfPhase < 5) {
                wfPhase++;
                setTimeout(updateWaterfallUI, 500);
            } else {
                log(`Project Complete. Total Cost: $${wfCost}`);
                document.getElementById('decisionBox').innerHTML = `<button class="btn-w" onclick="resetWaterfall()">Reset Simulation</button>`;
            }
        }

        function updateWaterfallUI() {
            // Update Phase Bubbles
            for(let i=1; i<=5; i++) {
                const el = document.getElementById(`p${i}`);
                el.classList.remove('active', 'completed');
                if(i < wfPhase) el.classList.add('completed');
                if(i === wfPhase) el.classList.add('active');
            }

            // Update Text
            if(wfPhase <= 5) document.getElementById('currentPhaseTitle').innerText = `Phase ${wfPhase}: ${phases[wfPhase-1]}`;
            
            document.getElementById('wfCost').innerText = `$${wfCost}`;
            document.getElementById('wfBugs').innerText = wfBugs;
            
            // Meter (Arbitrary scale)
            const pct = Math.min((wfCost / 50000) * 100, 100);
            document.getElementById('wfMeter').style.width = `${pct}%`;

            // Change button text based on phase
            if(wfPhase === 4) {
                document.getElementById('decisionBox').innerHTML = `<button class="btn-w" onclick="waterfallAction('run')">Run Final Tests</button>`;
            } else if (wfPhase === 5) {
                document.getElementById('decisionBox').innerHTML = `<div style="text-align:center; color:#a6e3a1">DEPLOYED</div>`;
            }
        }

        function resetWaterfall() {
            wfPhase = 1; wfCost = 0; wfBugs = 0;
            document.getElementById('decisionBox').innerHTML = `
                <button class="btn-w" onclick="waterfallAction('secure')">üõ°Ô∏è Review Security (Costly)</button>
                <button class="btn-d" onclick="waterfallAction('skip')">‚è© Skip (Risky)</button>
            `;
            updateWaterfallUI();
            log("Waterfall Simulation Reset.");
        }

        /* --- AGILE LOGIC --- */
        let sprintPts = 0;
        let sprintRisk = 0; // 0 = safe, 5 = hacked

        function moveCard(card) {
            const parent = card.parentElement.id;
            const pts = parseInt(card.getAttribute('data-pts'));
            const type = card.getAttribute('data-type');

            if (parent === 'col-backlog') {
                if (sprintPts + pts > 10) {
                    alert("Sprint Capacity Exceeded! Remove items first.");
                    return;
                }
                document.getElementById('col-sprint').appendChild(card);
                sprintPts += pts;
                if(type === 'sec') sprintRisk -= 2; // Security items reduce risk
            } else if (parent === 'col-sprint') {
                document.getElementById('col-backlog').appendChild(card);
                sprintPts -= pts;
                if(type === 'sec') sprintRisk += 2;
            }
            updateAgileUI();
        }

        function updateAgileUI() {
            document.getElementById('sprintCap').innerText = `${sprintPts} / 10`;
            
            // Calculate base risk from un-selected security items
            // In a real sim, we'd iterate the backlog. Simple logic:
            // Every Feature added increases risk slightly. Every Security added reduces it.
            let risk = 0;
            const sprintCards = document.getElementById('col-sprint').children;
            let featCount = 0;
            let secCount = 0;

            for(let c of sprintCards) {
                if(c.classList.contains('feature')) featCount++;
                if(c.classList.contains('security')) secCount++;
            }

            // Heuristic: High features + Low security = High Risk
            if (featCount > 0 && secCount === 0) risk = "HIGH";
            else if (featCount > secCount) risk = "MED";
            else risk = "LOW";

            const rLabel = document.getElementById('riskLevel');
            rLabel.innerText = risk;
            rLabel.style.color = risk === 'HIGH' ? 'var(--danger)' : (risk === 'MED' ? 'var(--warn)' : 'var(--agile)');
        }

        function runSprint() {
            const risk = document.getElementById('riskLevel').innerText;
            const doneCol = document.getElementById('col-done');
            const sprintCol = document.getElementById('col-sprint');
            
            // Move cards to done
            while(sprintCol.firstChild) {
                doneCol.appendChild(sprintCol.firstChild);
            }

            log(`Sprint Complete.`);
            
            if (risk === 'HIGH') {
                log(`‚ö†Ô∏è ALERT: You shipped features without security patches. Vulnerability exposed in Production!`, 'err');
                // Perhaps add a "Hacked" visual
            } else if (risk === 'MED') {
                log(`Sprint successful, but technical debt is accumulating.`);
            } else {
                log(`‚úÖ Secure Release! Features balanced with Security.`, 'success');
            }

            sprintPts = 0;
            updateAgileUI();
        }

    </script>
</body>
</html>