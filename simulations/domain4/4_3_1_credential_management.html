<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSSLP Domain 4: Credential Management Lab</title>
    <style>
        :root {
            --bg-dark: #0f172a;
            --panel-bg: #1e293b;
            --pki-purple: #a855f7;
            --sso-orange: #f97316;
            --text: #f8fafc;
            --success: #10b981;
            --danger: #ef4444;
            --code-bg: #0f172a;
        }
        body {
            font-family: 'Segoe UI', monospace;
            background-color: var(--bg-dark);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        header {
            background: #000;
            width: 100%;
            padding: 15px 0;
            text-align: center;
            border-bottom: 3px solid var(--pki-purple);
            margin-bottom: 20px;
        }
        h1 { margin: 0; font-size: 1.5rem; color: var(--pki-purple); }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            width: 95%;
            max-width: 1400px;
        }

        /* CARD STYLES */
        .lab-card {
            background: var(--panel-bg);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #334155;
            display: flex;
            flex-direction: column;
        }
        .card-header {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #475569;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .tag { padding: 3px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; }
        .tag.pki { background: rgba(168, 85, 247, 0.2); color: var(--pki-purple); border: 1px solid var(--pki-purple); }
        .tag.sso { background: rgba(249, 115, 22, 0.2); color: var(--sso-orange); border: 1px solid var(--sso-orange); }

        /* PKI VISUALIZATION */
        .chain-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
            background: #000;
            padding: 15px;
            border-radius: 8px;
        }
        .cert-node {
            background: #334155;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid #64748b;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        .cert-node.valid { border-left-color: var(--success); background: rgba(16, 185, 129, 0.1); }
        .cert-node.invalid { border-left-color: var(--danger); background: rgba(239, 68, 68, 0.1); }
        .link-icon { text-align: center; font-size: 1.2rem; color: #64748b; }

        /* SSO VISUALIZATION */
        .token-box {
            background: var(--code-bg);
            font-family: 'Courier New', monospace;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #475569;
            margin-bottom: 15px;
            word-break: break-all;
            font-size: 0.9rem;
        }
        .jwt-header { color: #f87171; }
        .jwt-payload { color: #c084fc; }
        .jwt-sig { color: #60a5fa; }

        /* CONTROLS */
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
            margin-top: 5px;
            background: #475569;
            color: white;
            width: 100%;
        }
        button:hover { background: #64748b; }
        button.attack-btn { background: var(--danger); }
        button.fix-btn { background: var(--success); color: #0f172a; }
        
        .status-output {
            margin-top: 15px;
            padding: 10px;
            background: #000;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
            min-height: 60px;
            border-left: 3px solid #475569;
        }

    </style>
</head>
<body>

<header>
    <h1>Credential Management Simulator</h1>
    <p>X.509 Chain of Trust & SSO Token Validation</p>
</header>

<div class="dashboard">

    <!-- LAB 1: X.509 PKI -->
    <div class="lab-card">
        <div class="card-header">
            <span>X.509 Certificate Chain</span>
            <span class="tag pki">INFRASTRUCTURE</span>
        </div>

        <div class="chain-container" id="pki-chain">
            <!-- Root CA -->
            <div class="cert-node" id="cert-root">
                <div>
                    <strong>ROOT CA</strong><br>
                    <span style="font-size:0.8rem; color:#aaa;">Issuer: Self | Exp: 2030</span>
                </div>
                <span>ðŸ”’</span>
            </div>
            <div class="link-icon">â¬‡</div>
            
            <!-- Intermediate -->
            <div class="cert-node" id="cert-inter">
                <div>
                    <strong>Intermediate CA</strong><br>
                    <span style="font-size:0.8rem; color:#aaa;">Issuer: Root CA | Exp: 2028</span>
                </div>
                <span>ðŸ”’</span>
            </div>
            <div class="link-icon">â¬‡</div>

            <!-- Leaf -->
            <div class="cert-node" id="cert-leaf">
                <div>
                    <strong>Leaf (Your Server)</strong><br>
                    <span style="font-size:0.8rem; color:#aaa;">Issuer: Intermediate | Exp: <span id="leaf-exp">2025</span></span>
                </div>
                <span id="leaf-lock">ðŸ”’</span>
            </div>
        </div>

        <div class="status-output" id="pki-output">
            > SYSTEM: Chain Loaded.<br>
            > STATUS: Valid.
        </div>

        <div style="display:flex; gap:10px; flex-direction:column;">
            <button onclick="pkiScenario('valid')">Reset: Valid Chain</button>
            <button class="attack-btn" onclick="pkiScenario('expired')">Attack: Server Sends Expired Cert</button>
            <button class="attack-btn" onclick="pkiScenario('untrusted')">Attack: Self-Signed / Untrusted Root</button>
        </div>
    </div>

    <!-- LAB 2: SSO / JWT -->
    <div class="lab-card">
        <div class="card-header">
            <span>SSO Token (JWT) Inspector</span>
            <span class="tag sso">IDENTITY</span>
        </div>

        <div class="token-box" id="jwt-display">
            <span class="jwt-header" id="jwt-h">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span>.<span class="jwt-payload" id="jwt-p">eyJ1c2VyIjoiZ3Vlc3QiLCJyb2xlIjoidXNlciJ9</span>.<span class="jwt-sig" id="jwt-s">SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c</span>
        </div>

        <div class="status-output" id="sso-output">
            > SSO: Token Received.<br>
            > USER: guest | ROLE: user<br>
            > SIG CHECK: <span style="color:var(--success)">PASSED</span> (HS256)
        </div>

        <div style="display:flex; gap:10px; flex-direction:column;">
            <button class="attack-btn" onclick="ssoAttack()">Attack: Forgery (Alg: None)</button>
            <button class="fix-btn" id="sso-fix-btn" onclick="toggleSsoFix()">Mitigation: Enforce Algorithm Whitelist</button>
        </div>
        
        <p style="font-size:0.8rem; color:#aaa; margin-top:10px;">
            <strong>Concept:</strong> The "Alg: None" attack involves stripping the signature and telling the server "No encryption used". If the server accepts "None", it blindly trusts the payload.
        </p>
    </div>

</div>

<script>
    // --- PKI LOGIC ---
    function pkiScenario(type) {
        const root = document.getElementById('cert-root');
        const inter = document.getElementById('cert-inter');
        const leaf = document.getElementById('cert-leaf');
        const out = document.getElementById('pki-output');
        const leafExp = document.getElementById('leaf-exp');

        // Reset Styles
        root.className = 'cert-node';
        inter.className = 'cert-node';
        leaf.className = 'cert-node';
        root.style.opacity = '1';
        
        if (type === 'valid') {
            leafExp.innerText = "2025";
            leafExp.style.color = "#aaa";
            root.classList.add('valid');
            inter.classList.add('valid');
            leaf.classList.add('valid');
            out.innerHTML = "> SYSTEM: Chain Validated.<br>> TRUST: Established to Root CA.";
            out.style.borderLeftColor = "var(--success)";
        } 
        else if (type === 'expired') {
            leafExp.innerText = "1999 (EXPIRED)";
            leafExp.style.color = "var(--danger)";
            root.classList.add('valid');
            inter.classList.add('valid');
            leaf.classList.add('invalid');
            out.innerHTML = "> ERROR: Leaf Certificate Expired.<br>> VALIDATION: FAILED. Connection Dropped.";
            out.style.borderLeftColor = "var(--danger)";
        }
        else if (type === 'untrusted') {
            leafExp.innerText = "2025";
            root.style.opacity = '0.3'; // Root unknown
            inter.style.opacity = '0.3'; 
            leaf.classList.add('invalid');
            out.innerHTML = "> ERROR: Unknown Issuer.<br>> REASON: Root CA not in System Trust Store.<br>> VALIDATION: FAILED.";
            out.style.borderLeftColor = "var(--danger)";
        }
    }

    // --- SSO LOGIC ---
    let ssoFixed = false;
    
    function toggleSsoFix() {
        ssoFixed = !ssoFixed;
        const btn = document.getElementById('sso-fix-btn');
        if(ssoFixed) {
            btn.innerText = "Mitigation Active (Whitelist ON)";
            btn.style.opacity = "0.7";
        } else {
            btn.innerText = "Mitigation: Enforce Algorithm Whitelist";
            btn.style.opacity = "1";
        }
    }

    function ssoAttack() {
        const header = document.getElementById('jwt-h');
        const payload = document.getElementById('jwt-p');
        const sig = document.getElementById('jwt-s');
        const out = document.getElementById('sso-output');

        // Simulate Attack: Change Header to 'none', Change Role to 'admin', Remove Sig
        header.innerText = "eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0"; // alg: none
        header.style.color = "var(--danger)";
        
        payload.innerText = "eyJ1c2VyIjoiZ3Vlc3QiLCJyb2xlIjoiYWRtaW4ifQ"; // role: admin
        payload.style.color = "var(--danger)";

        sig.innerText = ""; // Empty signature
        sig.style.borderBottom = "2px dashed var(--danger)";

        setTimeout(() => {
            if (ssoFixed) {
                out.innerHTML = "> SERVER: Parsing Token...<br>> HEADER: alg='none'<br>> ERROR: Algorithm 'none' NOT in Whitelist [HS256, RS256].<br>> <span style='color:var(--success)'>ATTACK BLOCKED.</span>";
                out.style.borderLeftColor = "var(--success)";
            } else {
                out.innerHTML = "> SERVER: Parsing Token...<br>> HEADER: alg='none' (Accepted)<br>> USER: guest | ROLE: <span style='color:var(--danger)'>ADMIN</span><br>> <span style='color:var(--danger)'>ATTACK SUCCESS: Privilege Escalation!</span>";
                out.style.borderLeftColor = "var(--danger)";
            }
        }, 500);
    }

    // Init
    pkiScenario('valid');
</script>

</body>
</html>