<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSSLP Domain 5: Systems-of-Systems Lab</title>
    <style>
        :root {
            --bg-dark: #0f172a;
            --panel-bg: #1e293b;
            --sos-teal: #14b8a6;
            --danger-red: #ef4444;
            --safe-green: #22c55e;
            --warn-yellow: #eab308;
            --text: #f1f5f9;
            --border: #334155;
        }
        body {
            font-family: 'Segoe UI', monospace;
            background-color: var(--bg-dark);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        header {
            background: #000;
            width: 100%;
            padding: 15px 0;
            text-align: center;
            border-bottom: 3px solid var(--sos-teal);
            margin-bottom: 20px;
        }
        h1 { margin: 0; font-size: 1.5rem; color: var(--sos-teal); }

        .dashboard {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            width: 95%;
            max-width: 1400px;
            height: 700px;
        }

        /* CONTROLS */
        .controls {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #334155;
        }
        
        .section-title {
            color: #94a3b8;
            font-size: 0.8rem;
            text-transform: uppercase;
            border-bottom: 1px solid #475569;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }

        /* Integration Toggles */
        .int-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 10px;
            background: #0f172a;
            border-radius: 4px;
            border: 1px solid #333;
        }
        .int-label { font-size: 0.8rem; font-weight: bold; }

        .switch { position: relative; display: inline-block; width: 34px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #555; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--sos-teal); }
        input:checked + .slider:before { transform: translateX(14px); }

        button {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            transition: 0.2s;
        }
        .btn-hack { background: var(--danger-red); }
        .btn-ddos { background: var(--warn-yellow); color: black; }
        .btn-circuit { background: var(--safe-green); color: black; }
        .btn-contract { background: var(--sos-teal); color: black; }
        
        button:hover { filter: brightness(1.1); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        /* VISUALIZATION */
        .viz-area {
            background: #000;
            border: 2px solid #334155;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
        }

        /* System Nodes */
        .system-grid {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 300px;
            position: relative;
        }

        .sys-node {
            width: 120px; height: 120px;
            background: #1e293b;
            border: 2px solid #555;
            border-radius: 50%;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 10;
            font-size: 0.8rem;
            text-align: center;
            transition: 0.3s;
        }
        .sys-icon { font-size: 2rem; margin-bottom: 5px; }
        .sys-status { font-size: 0.7rem; color: #aaa; }

        #sys-wifi { border-color: var(--warn-yellow); } /* Untrusted */
        #sys-traffic { border-color: var(--safe-green); } /* Critical */
        #sys-emerg { border-color: var(--sos-teal); } /* Trusted */

        .sys-node.hacked { border-color: var(--danger-red); background: #3e0a0a; animation: shake 0.5s; }
        .sys-node.offline { opacity: 0.5; border-style: dashed; }

        /* Connection Lines */
        .conn-line {
            position: absolute;
            height: 4px;
            background: #333;
            top: 50%;
            transform: translateY(-50%);
            z-index: 0;
            transition: 0.3s;
        }
        #conn-1 { left: 15%; width: 35%; } /* WiFi -> Traffic */
        #conn-2 { right: 15%; width: 35%; } /* Traffic -> Emerg */

        .conn-line.active { background: var(--sos-teal); }
        .conn-line.malicious { background: var(--danger-red); }

        /* Trust Contract Gate */
        .gate {
            position: absolute;
            width: 10px; height: 40px;
            background: #333;
            top: 50%; transform: translateY(-50%);
            z-index: 5;
            border-radius: 4px;
        }
        #gate-wifi { left: 32%; }
        
        .gate.secure { background: var(--safe-green); box-shadow: 0 0 10px var(--safe-green); }

        /* Traffic Lights Viz */
        .traffic-light {
            position: absolute;
            bottom: 20px; left: 50%; transform: translateX(-50%);
            background: #111;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #333;
            display: flex;
            gap: 10px;
        }
        .light { width: 30px; height: 30px; border-radius: 50%; background: #333; }
        .light.red { background: #ef4444; box-shadow: 0 0 15px #ef4444; }
        .light.green { background: #22c55e; box-shadow: 0 0 15px #22c55e; }

        /* LOGS */
        .console {
            background: #000;
            height: 150px;
            border: 1px solid #334155;
            padding: 10px;
            font-family: monospace;
            font-size: 0.85rem;
            color: #aaa;
            overflow-y: auto;
            margin-top: auto;
        }
        .log-sys { color: var(--sos-teal); }
        .log-err { color: var(--danger-red); }
        .log-ok { color: var(--safe-green); }

        @keyframes shake { 0% { transform: translate(1px, 1px); } 25% { transform: translate(-1px, -2px); } 75% { transform: translate(-1px, 2px); } }

    </style>
</head>
<body>

<header>
    <h1>Systems-of-Systems Integration Lab</h1>
    <p>Trust Contracts, Cascading Failures & Circuit Breakers</p>
</header>

<div class="dashboard">

    <!-- CONTROLS -->
    <div class="controls">
        <div class="section-title">1. Integration Config</div>
        
        <div class="int-row">
            <span class="int-label">Link: WiFi âž” Traffic</span>
            <label class="switch"><input type="checkbox" id="lnk-wifi" checked disabled><span class="slider"></span></label>
        </div>
        <div class="int-row">
            <span class="int-label">Link: Traffic âž” Emergency</span>
            <label class="switch"><input type="checkbox" id="lnk-emerg" checked disabled><span class="slider"></span></label>
        </div>

        <div class="section-title" style="margin-top:20px;">2. Security Controls</div>
        <button class="btn-contract" onclick="toggleContract()" id="btn-contract">ðŸ“œ Enforce Trust Contract (OFF)</button>
        <button class="btn-circuit" onclick="toggleCircuit()" id="btn-circuit">ðŸ”Œ Circuit Breaker (OFF)</button>

        <div class="section-title" style="margin-top:20px;">3. Threat Simulation</div>
        <button class="btn-hack" onclick="hackWifi()">ðŸ‘¾ Hack Public WiFi</button>
        <button class="btn-ddos" onclick="ddosEmergency()">ðŸ”¥ DDoS Emergency System</button>
        <button style="background:#333; color:white; margin-top:10px;" onclick="resetLab()">ðŸ”„ Reset System</button>
    </div>

    <!-- VISUALIZATION -->
    <div class="viz-area">
        
        <div class="system-grid">
            <!-- WiFi -->
            <div class="sys-node" id="sys-wifi">
                <div class="sys-icon">ðŸ“¶</div>
                <div>Public WiFi</div>
                <div class="sys-status">Untrusted</div>
            </div>

            <!-- Traffic -->
            <div class="sys-node" id="sys-traffic">
                <div class="sys-icon">ðŸš¦</div>
                <div>Traffic Ctrl</div>
                <div class="sys-status">Critical</div>
            </div>

            <!-- Emergency -->
            <div class="sys-node" id="sys-emerg">
                <div class="sys-icon">ðŸš‘</div>
                <div>Emergency</div>
                <div class="sys-status">Trusted</div>
            </div>

            <!-- Lines -->
            <div class="conn-line active" id="conn-1"></div>
            <div class="conn-line active" id="conn-2"></div>

            <!-- Gate -->
            <div class="gate" id="gate-wifi"></div>
        </div>

        <!-- Lights Status -->
        <div class="traffic-light">
            <div class="light red" id="l-red"></div>
            <div class="light" id="l-green"></div>
        </div>
        <div style="text-align:center; color:#aaa; font-size:0.8rem; margin-top:-10px;">Intersection Status</div>

        <!-- LOGS -->
        <div class="console" id="logger">
            <div>> Smart City Grid Online. Systems Integrated.</div>
        </div>

    </div>

</div>

<script>
    let contractActive = false;
    let circuitActive = false;
    let emergOnline = true;

    function log(msg, type) {
        const box = document.getElementById('logger');
        const div = document.createElement('div');
        const time = new Date().toLocaleTimeString().split(' ')[0];
        div.innerHTML = `<span style="color:#555">[${time}]</span> <span class="${type==='ok'?'log-ok':(type==='err'?'log-err':'log-sys')}">${msg}</span>`;
        box.prepend(div);
    }

    function toggleContract() {
        contractActive = !contractActive;
        const btn = document.getElementById('btn-contract');
        const gate = document.getElementById('gate-wifi');
        
        if(contractActive) {
            btn.innerText = "ðŸ“œ Enforce Trust Contract (ON)";
            btn.style.border = "2px solid white";
            gate.classList.add('secure');
            log("ARCH: Trust Contract applied (API Gateway + mTLS).", "ok");
        } else {
            btn.innerText = "ðŸ“œ Enforce Trust Contract (OFF)";
            btn.style.border = "none";
            gate.classList.remove('secure');
            log("ARCH: Trust Contract removed. Open integration.", "sys");
        }
    }

    function toggleCircuit() {
        circuitActive = !circuitActive;
        const btn = document.getElementById('btn-circuit');
        
        if(circuitActive) {
            btn.innerText = "ðŸ”Œ Circuit Breaker (ON)";
            btn.style.border = "2px solid white";
            log("ARCH: Circuit Breakers enabled for dependency failures.", "ok");
        } else {
            btn.innerText = "ðŸ”Œ Circuit Breaker (OFF)";
            btn.style.border = "none";
            log("ARCH: Circuit Breakers disabled.", "sys");
        }
    }

    function hackWifi() {
        log("ATTACK: Hacker compromised Public WiFi Node.", "err");
        document.getElementById('sys-wifi').classList.add('hacked');
        
        setTimeout(() => {
            log("ATTACK: Sending malicious 'ALL_GREEN' command to Traffic Controller...", "err");
            
            if (contractActive) {
                log("DEFENSE: Trust Contract Violation! Invalid Signature. Command Dropped.", "ok");
                flashConnection('conn-1', 'red', false); // Blocked
            } else {
                flashConnection('conn-1', 'red', true);
                document.getElementById('sys-traffic').classList.add('hacked');
                
                // Change Lights
                document.getElementById('l-red').classList.remove('red');
                document.getElementById('l-green').classList.add('green');
                
                log("FAILURE: Traffic System Compromised. All lights GREEN. Accidents imminent.", "err");
            }
        }, 1000);
    }

    function ddosEmergency() {
        log("ATTACK: DDoS targeting Emergency Response System.", "err");
        document.getElementById('sys-emerg').classList.add('offline');
        emergOnline = false;

        // Traffic system depends on Emergency system heartbeat
        setTimeout(() => {
            log("TRAFFIC: Pinging Emergency System...", "sys");
            
            if (circuitActive) {
                log("DEFENSE: Circuit Breaker Tripped! Emergency System Unreachable.", "ok");
                log("TRAFFIC: Entering 'Fail-Safe' Mode (Blinking Red). System isolated.", "ok");
                flashConnection('conn-2', 'red', false);
                
                // Fail Safe Viz
                setInterval(() => {
                    document.getElementById('l-red').classList.toggle('red');
                }, 500);
            } else {
                log("FAILURE: Traffic Controller waiting for response... (Thread Blocking)", "err");
                flashConnection('conn-2', 'yellow', true); // Hanging
                setTimeout(() => {
                    document.getElementById('sys-traffic').classList.add('offline'); // Crash
                    log("CRITICAL: Traffic System Cascading Failure. Controller Hung/Crashed.", "err");
                }, 1500);
            }
        }, 1000);
    }

    function flashConnection(id, color, propagate) {
        const line = document.getElementById(id);
        const original = line.style.backgroundColor;
        
        line.style.backgroundColor = color === 'red' ? 'var(--danger-red)' : 'var(--warn-yellow)';
        
        if (!propagate) {
            setTimeout(() => line.style.backgroundColor = '', 500);
        }
    }

    function resetLab() {
        document.querySelectorAll('.sys-node').forEach(n => {
            n.classList.remove('hacked', 'offline');
        });
        document.getElementById('l-red').classList.add('red');
        document.getElementById('l-green').classList.remove('green');
        emergOnline = true;
        log("SYSTEM: Grid Reset.", "sys");
        // Ideally clear intervals but simple reload works for this logic scope
    }

</script>

</body>
</html>