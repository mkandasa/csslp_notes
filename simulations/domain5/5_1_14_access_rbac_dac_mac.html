<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSSLP Domain 5: Access Control Lab</title>
    <style>
        :root {
            --bg-dark: #0f172a;
            --panel-bg: #1e293b;
            --ac-orange: #f97316;
            --dac-blue: #3b82f6;
            --mac-red: #ef4444;
            --rbac-purple: #a855f7;
            --text: #f1f5f9;
            --border: #334155;
        }
        body {
            font-family: 'Segoe UI', monospace;
            background-color: var(--bg-dark);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        header {
            background: #000;
            width: 100%;
            padding: 15px 0;
            text-align: center;
            border-bottom: 3px solid var(--ac-orange);
            margin-bottom: 20px;
        }
        h1 { margin: 0; font-size: 1.5rem; color: var(--ac-orange); }

        .dashboard {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            width: 95%;
            max-width: 1400px;
            height: 700px;
        }

        /* CONTROLS */
        .controls {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #334155;
        }
        
        .section-title {
            color: #94a3b8;
            font-size: 0.8rem;
            text-transform: uppercase;
            border-bottom: 1px solid #475569;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }

        /* Mode Switcher */
        .mode-tabs { display: flex; gap: 5px; margin-bottom: 20px; }
        .mode-btn {
            flex: 1; padding: 10px; border: none; cursor: pointer;
            background: #333; color: #ccc; border-radius: 4px; font-size: 0.8rem;
        }
        .mode-btn:hover { filter: brightness(1.2); }
        .active-dac { background: var(--dac-blue); color: white; }
        .active-mac { background: var(--mac-red); color: white; }
        .active-rbac { background: var(--rbac-purple); color: white; }

        /* User Selector */
        .user-select {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-bottom: 20px;
        }
        .user-option {
            padding: 10px;
            background: #0f172a;
            border: 1px solid #333;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
        }
        .user-option:hover { border-color: var(--ac-orange); }
        .user-option.selected { border-color: var(--ac-orange); background: rgba(249, 115, 22, 0.1); }

        button.action-btn {
            width: 100%; padding: 12px; background: #334155;
            color: white; border: none; border-radius: 4px;
            cursor: pointer; margin-top: 5px; border: 1px solid #555;
        }
        button.action-btn:hover { background: #475569; }

        /* VISUALIZATION */
        .viz-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* File System View */
        .fs-view {
            background: #000;
            border: 2px solid #334155;
            border-radius: 8px;
            padding: 20px;
            min-height: 250px;
            position: relative;
        }
        
        .file-card {
            background: #1e293b;
            border: 1px solid #475569;
            padding: 15px;
            border-radius: 6px;
            width: 200px;
            margin-bottom: 10px;
            position: relative;
        }
        .file-name { font-weight: bold; margin-bottom: 5px; }
        .file-meta { font-size: 0.75rem; color: #aaa; margin-bottom: 5px; }
        .file-acl { font-family: monospace; font-size: 0.7rem; color: #86efac; background: #000; padding: 5px; border-radius: 4px; }

        /* MAC Label Badge */
        .mac-badge {
            position: absolute; top: 10px; right: 10px;
            font-size: 0.6rem; padding: 2px 5px; border-radius: 3px;
            font-weight: bold; text-transform: uppercase;
        }
        .lvl-ts { background: var(--mac-red); color: white; }
        .lvl-s { background: var(--ac-orange); color: black; }
        .lvl-u { background: var(--safe-green); color: black; }

        /* LOGS */
        .console {
            background: #000;
            height: 150px;
            border: 1px solid #334155;
            padding: 10px;
            font-family: monospace;
            font-size: 0.85rem;
            color: #aaa;
            overflow-y: auto;
        }
        .log-sys { color: var(--ac-orange); }
        .log-err { color: var(--mac-red); }
        .log-ok { color: #86efac; }

    </style>
</head>
<body>

<header>
    <h1>Access Control Architecture Lab</h1>
    <p>Simulating DAC, MAC, and RBAC Models</p>
</header>

<div class="dashboard">

    <!-- CONTROLS -->
    <div class="controls">
        <div class="mode-tabs">
            <button class="mode-btn active-dac" onclick="setMode('dac')">DAC</button>
            <button class="mode-btn" onclick="setMode('mac')">MAC</button>
            <button class="mode-btn" onclick="setMode('rbac')">RBAC</button>
        </div>

        <div class="section-title">1. Current User Context</div>
        <div class="user-select" id="user-list">
            <!-- Users injected via JS -->
        </div>

        <div class="section-title" style="margin-top:20px;">2. Actions</div>
        <button class="action-btn" onclick="attemptAccess('read')">üìñ Read File / Data</button>
        <button class="action-btn" onclick="attemptAccess('write')">‚úèÔ∏è Write / Modify</button>
        <button class="action-btn" id="btn-share" onclick="shareResource()">ü§ù Grant Access (Share)</button>
    </div>

    <!-- VISUALIZATION -->
    <div class="viz-area">
        
        <!-- RESOURCE VIEW -->
        <div class="fs-view" id="resource-area">
            <h3 style="margin-top:0; color:#aaa; font-size:0.9rem;">Protected Resources</h3>
            <!-- File Card injected via JS -->
        </div>

        <!-- LOGS -->
        <div class="console" id="logger">
            <div>> Access Control Monitor Ready. Mode: DAC.</div>
        </div>

    </div>

</div>

<script>
    let mode = 'dac';
    let currentUser = 'alice';
    
    // Data Models
    const users = {
        alice: { name: 'Alice', clearance: 'Top Secret', role: 'Manager' },
        bob:   { name: 'Bob',   clearance: 'Secret',     role: 'Teller' },
        eve:   { name: 'Eve',   clearance: 'Unclassified', role: 'Intern' }
    };

    const resources = {
        dac: { owner: 'alice', acl: ['alice'] }, // Only owner initially
        mac: { label: 'Top Secret', owner: 'system' }, // Label determines access
        rbac: { role: 'Manager', owner: 'system' } // Role determines access
    };

    function init() {
        renderUsers();
        renderResource();
    }

    function log(msg, type) {
        const box = document.getElementById('logger');
        const div = document.createElement('div');
        const time = new Date().toLocaleTimeString().split(' ')[0];
        div.innerHTML = `<span style="color:#555">[${time}]</span> <span class="${type==='ok'?'log-ok':(type==='err'?'log-err':'log-sys')}">${msg}</span>`;
        box.prepend(div);
    }

    function setMode(m) {
        mode = m;
        // Reset Visuals
        document.querySelectorAll('.mode-btn').forEach(b => {
            b.className = 'mode-btn'; // remove active classes
        });
        const btn = Array.from(document.querySelectorAll('.mode-btn'))
            .find(b => b.innerText.toLowerCase() === m);
        
        if(m === 'dac') btn.classList.add('active-dac');
        if(m === 'mac') btn.classList.add('active-mac');
        if(m === 'rbac') btn.classList.add('active-rbac');

        // Reset Data State for Demo consistency
        resources.dac.acl = ['alice']; 
        
        // UI updates
        const shareBtn = document.getElementById('btn-share');
        if (m === 'dac') {
            shareBtn.style.display = 'block';
            shareBtn.innerText = "ü§ù Grant Access (Share)";
        } else {
            shareBtn.style.display = 'none'; // Users can't share in MAC/RBAC
        }

        renderResource();
        log(`SWITCH: Access Control Model changed to ${m.toUpperCase()}.`, "sys");
    }

    function renderUsers() {
        const list = document.getElementById('user-list');
        list.innerHTML = "";
        
        for (const [key, u] of Object.entries(users)) {
            const div = document.createElement('div');
            div.className = `user-option ${key === currentUser ? 'selected' : ''}`;
            div.onclick = () => selectUser(key);
            div.innerHTML = `
                <div><strong>${u.name}</strong></div>
                <div style="font-size:0.7rem; color:#aaa; text-align:right;">
                    Lvl: ${u.clearance}<br>Role: ${u.role}
                </div>
            `;
            list.appendChild(div);
        }
    }

    function selectUser(u) {
        currentUser = u;
        renderUsers();
        log(`CONTEXT: Switched to user '${users[u].name}'.`, "sys");
    }

    function renderResource() {
        const area = document.getElementById('resource-area');
        area.innerHTML = '<h3 style="margin-top:0; color:#aaa; font-size:0.9rem;">Protected Resources</h3>';

        const card = document.createElement('div');
        card.className = "file-card";
        
        if (mode === 'dac') {
            card.innerHTML = `
                <div class="file-name">üìÑ Project_Report.doc</div>
                <div class="file-meta">Owner: ${resources.dac.owner}</div>
                <div class="file-acl">ACL: [${resources.dac.acl.join(', ')}]</div>
            `;
        } 
        else if (mode === 'mac') {
            card.innerHTML = `
                <div class="file-name">‚ò¢Ô∏è Nuclear_Codes.txt</div>
                <div class="file-meta">Owner: SYSTEM</div>
                <div class="mac-badge lvl-ts">TOP SECRET</div>
                <div class="file-acl">Policy: No Read Up, No Write Down</div>
            `;
        }
        else if (mode === 'rbac') {
            card.innerHTML = `
                <div class="file-name">üí∞ Loan_Approval_App</div>
                <div class="file-meta">Owner: Enterprise</div>
                <div class="file-acl">Required Role: ${resources.rbac.role}</div>
            `;
        }
        area.appendChild(card);
    }

    function attemptAccess(action) {
        const user = users[currentUser];
        let allowed = false;
        let reason = "";

        if (mode === 'dac') {
            // DAC: Check ACL
            if (resources.dac.acl.includes(currentUser)) {
                allowed = true;
                reason = `User '${currentUser}' is in the ACL.`;
            } else {
                reason = `User '${currentUser}' is NOT in the ACL.`;
            }
        } 
        else if (mode === 'mac') {
            // MAC: Bell-LaPadula (Simple)
            // Resource is Top Secret
            // Alice (TS), Bob (S), Eve (U)
            
            const levels = { 'Unclassified': 0, 'Secret': 1, 'Top Secret': 2 };
            const userLvl = levels[user.clearance];
            const fileLvl = 2; // TS

            if (action === 'read') {
                // No Read Up
                if (userLvl >= fileLvl) {
                    allowed = true;
                    reason = `Clearance (${user.clearance}) >= Label (Top Secret).`;
                } else {
                    reason = `Clearance (${user.clearance}) < Label (Top Secret). READ UP denied.`;
                }
            } else {
                // Write - simplified for demo (usually Write Down is denied, Write Up allowed *blindly*)
                // Let's assume strict equality for simplicity in this lab visual
                if (userLvl === fileLvl) {
                    allowed = true;
                    reason = `Clearance matches Label.`;
                } else {
                    reason = "Mandatory Policy restricts writing.";
                }
            }
        }
        else if (mode === 'rbac') {
            // RBAC: Check Role
            if (user.role === resources.rbac.role) {
                allowed = true;
                reason = `User has required role '${user.role}'.`;
            } else {
                reason = `User role '${user.role}' != Required '${resources.rbac.role}'.`;
            }
        }

        if (allowed) {
            log(`ACCESS GRANTED: ${reason}`, "ok");
        } else {
            log(`ACCESS DENIED: ${reason}`, "err");
        }
    }

    function shareResource() {
        if (mode !== 'dac') return; // Should be hidden anyway

        // Only owner (or someone with Full Control) can share
        // Simplified: anyone with access can share (The Discretionary flaw!)
        if (resources.dac.acl.includes(currentUser)) {
            // Simulate sharing with Bob if not already
            if (!resources.dac.acl.includes('bob')) {
                resources.dac.acl.push('bob');
                log(`DAC: ${users[currentUser].name} granted access to Bob.`, "ok");
            } 
            // If Bob is current, share with Eve
            else if (currentUser === 'bob' && !resources.dac.acl.includes('eve')) {
                resources.dac.acl.push('eve');
                log(`DAC RISK: Bob (Access holder) granted access to Eve. Alice (Owner) did not approve this!`, "err");
            }
            else {
                log("DAC: User attempting to share...", "sys");
            }
            renderResource();
        } else {
            log("DAC ERROR: You cannot share a file you cannot access.", "err");
        }
    }

    // Start
    init();

</script>

</body>
</html>