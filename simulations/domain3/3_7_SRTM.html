<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSSLP Domain 3: Traceability Matrix (SRTM)</title>
    <style>
        :root {
            --bg: #0f172a;
            --panel: #1e293b;
            --text: #f8fafc;
            --accent: #a78bfa; /* Purple */
            --req: #38bdf8;    /* Blue */
            --code: #facc15;   /* Yellow */
            --test: #10b981;   /* Green */
            --fail: #ef4444;   /* Red */
            --border: #334155;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 { border-bottom: 2px solid var(--accent); padding-bottom: 10px; margin-bottom: 20px; text-align: center; }

        .container {
            width: 100%; max-width: 1000px;
        }

        .card {
            background: var(--panel); padding: 25px; border-radius: 12px;
            border: 1px solid var(--border); height: fit-content; margin-bottom: 20px;
        }
        .card h3 { margin-top: 0; color: var(--accent); border-bottom: 1px solid var(--border); padding-bottom: 10px; }

        /* --- Traceability Matrix Styles --- */
        .srtm-container { overflow-x: auto; }
        .srtm-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; margin-top: 10px; }
        .srtm-table th { text-align: left; background: #111; padding: 10px; border-bottom: 1px solid #555; color: #aaa; text-transform: uppercase; font-size: 0.8rem; }
        .srtm-table td { padding: 10px; border-bottom: 1px solid #333; background: #1a1a1a; vertical-align: middle; }
        
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; text-transform: uppercase; font-weight: bold; display: inline-block; min-width: 80px; text-align: center; }
        .status-gap { background: rgba(239, 68, 68, 0.2); color: var(--fail); border: 1px solid var(--fail); }
        .status-ok { background: rgba(16, 185, 129, 0.2); color: var(--test); border: 1px solid var(--test); }
        .status-gold { background: rgba(250, 204, 21, 0.2); color: var(--code); border: 1px solid var(--code); }

        .link-select { background: #000; color: white; border: 1px solid #555; padding: 6px; border-radius: 4px; width: 100%; cursor: pointer; }
        .link-select:hover { border-color: var(--accent); }

        /* --- Buttons --- */
        button {
            padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer;
            font-weight: bold; transition: opacity 0.2s; width: 100%; margin-top: 10px; font-size: 1rem;
        }
        button:hover { opacity: 0.9; }
        .btn-trace { background: var(--accent); color: #000; }

        /* --- Logs --- */
        .log-terminal {
            background: #000; height: 150px; 
            padding: 15px; overflow-y: auto; font-family: monospace; 
            border: 1px solid var(--border); color: var(--accent); font-size: 0.9rem; margin-top: 20px; border-radius: 8px;
        }
        .log-err { color: var(--fail); }
        .log-ok { color: var(--test); }
        .log-info { color: var(--accent); }

        /* --- Diagram --- */
        .trace-diagram {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;
            padding: 20px; background: #111; border-radius: 8px; border: 1px dashed #444;
        }
        .trace-node {
            padding: 10px; border-radius: 6px; border: 2px solid #555; width: 100px; text-align: center;
            font-size: 0.8rem; background: #222;
        }
        .arrow { font-size: 1.5rem; color: #555; }
        
        .node-req { border-color: var(--req); color: var(--req); }
        .node-code { border-color: var(--code); color: var(--code); }
        .node-test { border-color: var(--test); color: var(--test); }

    </style>
</head>
<body>

    <h1>CSSLP: Security Traceability Console</h1>

    <div class="container">
        
        <div class="card">
            <h3>Traceability Logic</h3>
            <div class="trace-diagram">
                <div class="trace-node node-req">Requirement<br>(What)</div>
                <div class="arrow">➜</div>
                <div class="trace-node node-code">Code Module<br>(How)</div>
                <div class="arrow">➜</div>
                <div class="trace-node node-test">Test Case<br>(Proof)</div>
            </div>
            <p style="font-size:0.9rem; color:#aaa; text-align:center">
                <strong>Goal:</strong> Ensure every Requirement has Code, and every Code has a Test.
            </p>
        </div>

        <div class="card">
            <h3>Security Requirement Traceability Matrix (SRTM)</h3>
            <p>Link the artifacts to close the gaps.</p>
            
            <div class="srtm-container">
                <table class="srtm-table">
                    <thead>
                        <tr>
                            <th width="10%">Req ID</th>
                            <th width="30%">Description</th>
                            <th width="20%">Code Module</th>
                            <th width="20%">Test Case</th>
                            <th width="20%">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Row 1: Complete -->
                        <tr>
                            <td style="color:var(--req)">SEC-01</td>
                            <td>Encrypt User Passwords</td>
                            <td><code>AuthService.java</code></td>
                            <td><code>TC-ENC-01</code></td>
                            <td><span class="status-badge status-ok">Complete</span></td>
                        </tr>
                        
                        <!-- Row 2: Gap (Missing Test) -->
                        <tr>
                            <td style="color:var(--req)">SEC-02</td>
                            <td>Enforce MFA for Admins</td>
                            <td><code>MfaProvider.js</code></td>
                            <td>
                                <select id="link-test-2" class="link-select">
                                    <option value="none">-- Missing --</option>
                                    <option value="TC-MFA-05">TC-MFA-05 (Verify MFA)</option>
                                </select>
                            </td>
                            <td><span id="status-2" class="status-badge status-gap">GAP: No Test</span></td>
                        </tr>
                        
                        <!-- Row 3: Gap (Missing Code) -->
                        <tr>
                            <td style="color:var(--req)">SEC-03</td>
                            <td>Centralized Audit Logging</td>
                            <td>
                                <select id="link-code-3" class="link-select">
                                    <option value="none">-- Missing --</option>
                                    <option value="Logger.cs">Logger.cs</option>
                                </select>
                            </td>
                            <td><code>TC-LOG-09</code></td>
                            <td><span id="status-3" class="status-badge status-gap">GAP: No Code</span></td>
                        </tr>
                        
                        <!-- Row 4: Gold Plating -->
                        <tr>
                            <td style="color:var(--code)">???</td>
                            <td>(Undefined Requirement)</td>
                            <td><code>Backdoor.php</code></td>
                            <td>--</td>
                            <td><span class="status-badge status-gold">Gold Plating</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <button class="btn-trace" onclick="validateMatrix()">Validate Matrix</button>
        </div>

        <!-- LOGS -->
        <div class="log-terminal" id="logs">
            <div>> SRTM Console Ready. Identifying gaps...</div>
        </div>

    </div>

    <script>
        function log(msg, type='info') {
            const term = document.getElementById('logs');
            const cls = type === 'err' ? 'log-err' : (type === 'ok' ? 'log-ok' : 'log-info');
            term.innerHTML += `<div class="${cls}">> ${msg}</div>`;
            term.scrollTop = term.scrollHeight;
        }

        function validateMatrix() {
            const test2 = document.getElementById('link-test-2').value;
            const code3 = document.getElementById('link-code-3').value;
            let gaps = 0;

            log("--- Starting Traceability Scan ---");

            // Row 1
            log("SEC-01: Verified. (Req -> Code -> Test)", 'ok');

            // Row 2 (MFA)
            if (test2 !== 'none') {
                document.getElementById('status-2').innerText = "Complete";
                document.getElementById('status-2').className = "status-badge status-ok";
                log("SEC-02: Gap Closed. MFA Test Case linked.", 'ok');
            } else {
                log("SEC-02: GAP! Code 'MfaProvider.js' exists but has NO Verification.", 'err');
                gaps++;
            }

            // Row 3 (Logging)
            if (code3 !== 'none') {
                document.getElementById('status-3').innerText = "Complete";
                document.getElementById('status-3').className = "status-badge status-ok";
                log("SEC-03: Gap Closed. Audit Code linked.", 'ok');
            } else {
                log("SEC-03: GAP! Requirement 'Audit Logging' has NO Implementation.", 'err');
                gaps++;
            }

            // Row 4 (Gold Plating)
            log("WARNING: 'Backdoor.php' found in codebase. No Requirement ID traces to this. Potential Malware or Unauthorized Feature.", 'err');

            if(gaps === 0) log("Scan Complete: All Requirements Traced.", 'ok');
            else log(`Scan Complete: ${gaps} Critical Gaps remain.`, 'err');
        }

    </script>
</body>
</html>