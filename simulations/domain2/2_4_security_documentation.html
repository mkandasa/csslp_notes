<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSSLP Domain 2: Security Documentation</title>
    <style>
        :root {
            --bg: #0f172a;
            --panel: #1e293b;
            --text: #e2e8f0;
            --accent: #f59e0b; /* Amber */
            --policy: #ef4444; /* Red */
            --standard: #f97316; /* Orange */
            --guide: #10b981;  /* Green */
            --doc: #3b82f6;    /* Blue for Docs */
            --border: #334155;
        }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 { border-bottom: 2px solid var(--accent); padding-bottom: 10px; margin-bottom: 20px; text-align: center; }

        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
        .tab-btn {
            background: var(--panel); color: #9ca3af;
            border: 1px solid var(--border); padding: 10px 20px;
            cursor: pointer; border-radius: 6px;
            font-weight: bold; transition: all 0.2s;
        }
        .tab-btn:hover { background: #374151; }
        .tab-btn.active { background: var(--accent); color: #000; border-color: var(--accent); }
        
        .tab-content { display: none; width: 100%; max-width: 1000px; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: var(--panel); padding: 25px; border-radius: 12px;
            border: 1px solid var(--border); height: fit-content; margin-bottom: 20px;
        }
        .card h3 { margin-top: 0; color: var(--accent); border-bottom: 1px solid var(--border); padding-bottom: 10px; }

        /* --- Drag & Drop (Hierarchy) --- */
        .drop-zone {
            min-height: 100px; border: 2px dashed #555; margin-bottom: 10px; padding: 10px;
            border-radius: 6px; position: relative;
        }
        .drop-zone::before {
            content: attr(data-label); position: absolute; top: 5px; right: 10px; 
            font-size: 0.8rem; font-weight: bold; opacity: 0.5; text-transform: uppercase;
        }
        .zone-policy { border-color: var(--policy); background: rgba(239, 68, 68, 0.1); }
        .zone-standard { border-color: var(--standard); background: rgba(249, 115, 22, 0.1); }
        .zone-guide { border-color: var(--guide); background: rgba(16, 185, 129, 0.1); }

        .draggable-item {
            background: #334155; padding: 10px; margin-bottom: 5px; border-radius: 4px;
            cursor: grab; border: 1px solid #475569; font-size: 0.9rem;
        }
        .draggable-item:active { cursor: grabbing; opacity: 0.8; }

        /* --- Coding Guide --- */
        .code-snippet {
            font-family: monospace; background: #000; padding: 10px; border-radius: 6px;
            border: 1px solid #444; margin-bottom: 10px; color: #ccc;
        }
        .guideline-option {
            display: flex; align-items: center; gap: 10px; background: #111; padding: 10px;
            margin-bottom: 5px; border-radius: 4px; cursor: pointer; border: 1px solid #333;
        }
        .guideline-option:hover { border-color: var(--accent); }
        .guideline-option.selected { border-color: var(--guide); background: #064e3b; }

        /* --- Document Generator Styles --- */
        .doc-form { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9rem; }
        input, select, textarea {
            width: 100%; padding: 8px; background: #111; border: 1px solid #444;
            color: white; border-radius: 4px; box-sizing: border-box; font-family: inherit;
        }
        
        .preview-box {
            background: #fff; color: #000; padding: 20px; border-radius: 4px;
            font-family: 'Georgia', serif; height: 300px; overflow-y: auto;
            border: 1px solid #ccc; white-space: pre-wrap;
        }
        .preview-header { font-weight: bold; text-decoration: underline; margin-bottom: 10px; font-size: 1.1rem; }

        /* --- Buttons --- */
        button {
            padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer;
            font-weight: bold; transition: opacity 0.2s; width: 100%; margin-top: 10px;
        }
        button:hover { opacity: 0.9; }
        .btn-action { background: var(--accent); color: #000; }
        .btn-gen { background: var(--doc); color: white; }

        /* --- Logs --- */
        .log-terminal {
            grid-column: span 2; background: #000; height: 120px; 
            padding: 10px; overflow-y: auto; font-family: monospace; 
            border: 1px solid var(--border); color: #a6e3a1; font-size: 0.9rem; margin-top: 20px;
        }
        .log-err { color: var(--policy); }
        .log-ok { color: var(--guide); }

    </style>
</head>
<body>

    <h1>CSSLP: Security Documentation Suite</h1>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('hierarchy')">1. Policy Hierarchy</button>
        <button class="tab-btn" onclick="switchTab('generator')">2. Document Generator</button>
        <button class="tab-btn" onclick="switchTab('guide')">3. Secure Coding Guide</button>
        <button class="tab-btn" onclick="switchTab('audit')">4. Compliance Audit</button>
    </div>

    <!-- TAB 1: HIERARCHY (Existing) -->
    <div id="hierarchy" class="tab-content active">
        <div class="card">
            <h3>Classify the Statements</h3>
            <p>Drag statements to Policy (High Level), Standard (Specific), or Guideline (Advice).</p>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                <div id="sourceContainer" style="background:#111; padding:10px; border-radius:6px;">
                    <div class="draggable-item" draggable="true" id="item1">"All passwords must be encrypted." (Mandatory Intent)</div>
                    <div class="draggable-item" draggable="true" id="item2">"Use bcrypt with work factor 12." (Specific Tech)</div>
                    <div class="draggable-item" draggable="true" id="item3">"Consider using a password manager." (Advice)</div>
                    <div class="draggable-item" draggable="true" id="item4">"Data must be classified by sensitivity." (Mandatory Intent)</div>
                    <div class="draggable-item" draggable="true" id="item5">"Use TLS 1.3 for transport." (Specific Tech)</div>
                </div>
                <div>
                    <div class="drop-zone zone-policy" id="dropPolicy" data-label="Policy"></div>
                    <div class="drop-zone zone-standard" id="dropStandard" data-label="Standard"></div>
                    <div class="drop-zone zone-guide" id="dropGuide" data-label="Guideline"></div>
                </div>
            </div>
            <button class="btn-action" onclick="checkHierarchy()">Validate Classification</button>
        </div>
    </div>

    <!-- TAB 2: DOCUMENT GENERATOR (NEW) -->
    <div id="generator" class="tab-content">
        <div class="card">
            <h3>Security Document Generator</h3>
            <p>Select a document type and configure the parameters to generate a formal artifact.</p>
            
            <div style="margin-bottom:20px;">
                <label>Document Type:</label>
                <select id="docType" onchange="updateForm()">
                    <option value="design">Security Design Document (SDD)</option>
                    <option value="deploy">Secure Deployment Guide</option>
                    <option value="retention">Data Retention Policy</option>
                    <option value="irp">Incident Response Plan (IRP)</option>
                    <option value="user">User/Admin Security Guide</option>
                </select>
            </div>

            <div class="doc-form">
                <!-- Dynamic Inputs -->
                <div id="formInputs">
                    <!-- Injected by JS -->
                </div>

                <!-- Preview -->
                <div>
                    <label>Document Preview:</label>
                    <div class="preview-box" id="docPreview">
                        Select a document type to begin...
                    </div>
                </div>
            </div>

            <button class="btn-gen" onclick="generateDoc()">üìÑ Generate & Sign Off</button>
        </div>
    </div>

    <!-- TAB 3: CODING GUIDE (Existing) -->
    <div id="guide" class="tab-content">
        <div class="card">
            <h3>Authoring a Secure Coding Standard</h3>
            <p>Select the correct rules for "SQL Injection Prevention".</p>
            <div class="guideline-option" onclick="toggleOption(this, 'correct')">
                <div style="font-size:1.5rem">‚úÖ</div>
                <div><strong>Rule A:</strong> "Use Parameterized Queries (Prepared Statements)."</div>
            </div>
            <div class="guideline-option" onclick="toggleOption(this, 'wrong')">
                <div style="font-size:1.5rem">‚ùå</div>
                <div><strong>Rule B:</strong> "Sanitize input by removing single quotes manually."</div>
            </div>
            <div class="guideline-option" onclick="toggleOption(this, 'wrong')">
                <div style="font-size:1.5rem">‚ùå</div>
                <div><strong>Rule C:</strong> "Use Stored Procedures with dynamic string concatenation."</div>
            </div>
            <div class="guideline-option" onclick="toggleOption(this, 'correct')">
                <div style="font-size:1.5rem">‚úÖ</div>
                <div><strong>Rule D:</strong> "Apply Principle of Least Privilege to DB Accounts."</div>
            </div>
            <button class="btn-action" onclick="publishGuide()">Publish Guide</button>
        </div>
    </div>

    <!-- TAB 4: AUDIT (Existing) -->
    <div id="audit" class="tab-content">
        <div class="card">
            <h3>Compliance Audit</h3>
            <p>Check code against the Standard.</p>
            <div class="code-snippet">
String query = "SELECT * FROM users WHERE name='" + user + "'";
statement.execute(query);
            </div>
            <div style="display:flex; gap:10px;">
                <button style="background:var(--policy); color:white" onclick="auditResult('fail')">Flag Non-Compliant</button>
                <button style="background:var(--guide); color:white" onclick="auditResult('pass')">Mark Compliant</button>
            </div>
        </div>
    </div>

    <!-- LOGS -->
    <div class="log-terminal" id="logs">
        <div>> Documentation System Initialized.</div>
    </div>

    <script>
        /* --- TABS --- */
        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(d => d.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            const map = {'hierarchy':0, 'generator':1, 'guide':2, 'audit':3};
            document.querySelectorAll('.tab-btn')[map[id]].classList.add('active');
        }

        function log(msg, type='info') {
            const term = document.getElementById('logs');
            const cls = type === 'err' ? 'log-err' : (type === 'ok' ? 'log-ok' : '');
            term.innerHTML += `<div class="${cls}">> ${msg}</div>`;
            term.scrollTop = term.scrollHeight;
        }

        /* --- DRAG DROP --- */
        let draggedItem = null;
        const items = document.querySelectorAll('.draggable-item');
        const zones = document.querySelectorAll('.drop-zone');
        const source = document.getElementById('sourceContainer');

        items.forEach(item => {
            item.addEventListener('dragstart', () => { draggedItem = item; setTimeout(() => item.style.display = 'none', 0); });
            item.addEventListener('dragend', () => { setTimeout(() => item.style.display = 'block', 0); draggedItem = null; });
        });

        zones.forEach(zone => {
            zone.addEventListener('dragover', e => e.preventDefault());
            zone.addEventListener('drop', e => { e.preventDefault(); zone.appendChild(draggedItem); });
        });
        
        source.addEventListener('dragover', e => e.preventDefault());
        source.addEventListener('drop', e => { e.preventDefault(); source.appendChild(draggedItem); });

        function checkHierarchy() {
            const p = document.getElementById('dropPolicy');
            const s = document.getElementById('dropStandard');
            const g = document.getElementById('dropGuide');
            let score = 0;
            
            if(p.contains(document.getElementById('item1'))) score++;
            if(p.contains(document.getElementById('item4'))) score++;
            if(s.contains(document.getElementById('item2'))) score++;
            if(s.contains(document.getElementById('item5'))) score++;
            if(g.contains(document.getElementById('item3'))) score++;

            if(score === 5) log("Hierarchy Validation: PERFECT!", 'ok');
            else log(`Hierarchy Validation: ${score}/5 Correct.`, 'err');
        }

        /* --- DOC GENERATOR --- */
        const forms = {
            'design': `
                <div class="form-group"><label>Asset Classification:</label><select id="inp1"><option>Confidential</option><option>Public</option></select></div>
                <div class="form-group"><label>Authentication Model:</label><select id="inp2"><option>OIDC/OAuth2</option><option>LDAP</option><option>Local DB</option></select></div>
                <div class="form-group"><label>Encryption (At Rest):</label><input type="text" id="inp3" value="AES-256-GCM"></div>
            `,
            'deploy': `
                <div class="form-group"><label>Target Env:</label><select id="inp1"><option>AWS Cloud</option><option>On-Premise Linux</option></select></div>
                <div class="form-group"><label>Port Config:</label><input type="text" id="inp2" value="443 Only (Block 80)"></div>
                <div class="form-group"><label>Secret Mgmt:</label><select id="inp3"><option>Environment Vars</option><option>Vault Integration</option></select></div>
            `,
            'retention': `
                <div class="form-group"><label>Data Type:</label><select id="inp1"><option>PII (User Data)</option><option>Financial Logs</option></select></div>
                <div class="form-group"><label>Retention Period:</label><select id="inp2"><option>30 Days</option><option>1 Year</option><option>7 Years</option><option>Forever (Bad Practice)</option></select></div>
                <div class="form-group"><label>Disposal Method:</label><input type="text" id="inp3" value="Crypto-Shredding"></div>
            `,
            'irp': `
                <div class="form-group"><label>Incident Type:</label><select id="inp1"><option>Data Breach</option><option>DDoS</option><option>Ransomware</option></select></div>
                <div class="form-group"><label>RTO (Recovery Time Obj):</label><input type="text" id="inp2" value="4 Hours"></div>
                <div class="form-group"><label>Communication Lead:</label><input type="text" id="inp3" value="CISO / Legal"></div>
            `,
            'user': `
                <div class="form-group"><label>Role:</label><select id="inp1"><option>End User</option><option>System Admin</option></select></div>
                <div class="form-group"><label>MFA Requirement:</label><select id="inp2"><option>Mandatory</option><option>Optional</option></select></div>
                <div class="form-group"><label>Support Contact:</label><input type="text" id="inp3" value="security@example.com"></div>
            `
        };

        function updateForm() {
            const type = document.getElementById('docType').value;
            document.getElementById('formInputs').innerHTML = forms[type];
            document.getElementById('docPreview').innerText = "Fill out the form to generate preview...";
        }

        function generateDoc() {
            const type = document.getElementById('docType').value;
            const v1 = document.getElementById('inp1').value;
            const v2 = document.getElementById('inp2').value;
            const v3 = document.getElementById('inp3').value;
            const date = new Date().toISOString().split('T')[0];

            let content = "";

            if (type === 'design') {
                content = `SECURITY DESIGN DOCUMENT (SDD)\nDate: ${date}\n\n1. ASSET CLASSIFICATION\nThe system processes ${v1} data. All controls must align with the Data Handling Policy for this level.\n\n2. AUTHENTICATION ARCHITECTURE\nPrimary authentication shall be performed via ${v2}. Session tokens must be signed (JWT) and encrypted.\n\n3. CRYPTOGRAPHY\nData at rest must be encrypted using ${v3}. Keys must be rotated annually.`;
            } else if (type === 'deploy') {
                content = `SECURE DEPLOYMENT GUIDE\nDate: ${date}\n\n1. ENVIRONMENT\nTarget: ${v1}. Ensure hardening scripts (CIS Benchmarks) are applied before app installation.\n\n2. NETWORK CONFIGURATION\nFirewall rules: ${v2}. No other ports shall be exposed to the public internet.\n\n3. SECRETS MANAGEMENT\nApplication secrets must be injected via ${v3}. NEVER commit secrets to git.`;
            } else if (type === 'retention') {
                content = `DATA RETENTION POLICY\nDate: ${date}\n\n1. SCOPE\nThis policy applies to ${v1}.\n\n2. RETENTION PERIOD\nData shall be retained for exactly ${v2}. Retaining data longer than necessary violates Privacy Principles (GDPR Art 5e).\n\n3. DISPOSAL\nUpon expiration, data must be destroyed via ${v3}.`;
                if(v2.includes("Forever")) log("WARNING: 'Forever' retention violates Data Minimization principles!", 'err');
            } else if (type === 'irp') {
                content = `INCIDENT RESPONSE PLAN (IRP)\nDate: ${date}\n\n1. SCENARIO\nResponse playbook for: ${v1}.\n\n2. RECOVERY OBJECTIVES\nTarget RTO: ${v2}. If RTO is missed, escalate to Crisis Management Team.\n\n3. ROLES & RESP\nExternal communication is handled SOLELY by ${v3}. Engineers must not speak to press.`;
            } else if (type === 'user') {
                content = `USER SECURITY GUIDE\nDate: ${date}\n\n1. AUDIENCE\nThis guide is for the ${v1} role.\n\n2. AUTHENTICATION\nMulti-Factor Authentication (MFA) is ${v2}. It is highly recommended to use a Hardware Key.\n\n3. REPORTING\nReport suspicious activity immediately to ${v3}.`;
            }

            document.getElementById('docPreview').innerText = content;
            log(`Document Generated: ${type.toUpperCase()}`, 'ok');
        }

        /* --- CODING GUIDE --- */
        function toggleOption(el, type) {
            if(el.classList.contains('selected')) {
                el.classList.remove('selected');
            } else {
                el.classList.add('selected');
                el.dataset.type = type;
            }
        }

        function publishGuide() {
            const selected = document.querySelectorAll('.guideline-option.selected');
            let correct = 0; let wrong = 0;
            selected.forEach(el => { if(el.dataset.type === 'correct') correct++; else wrong++; });

            if(correct === 2 && wrong === 0) log("Guide Published: EXCELLENT.", 'ok');
            else if (wrong > 0) log("Guide Rejected: Contains bad advice.", 'err');
            else log("Guide Incomplete.", 'err');
        }

        /* --- AUDIT --- */
        function auditResult(res) {
            if(res === 'fail') log("Audit Correct: SQL Injection found.", 'ok');
            else log("Audit Error: You marked vuln code as compliant.", 'err');
        }

        // Init
        updateForm();

    </script>
</body>
</html>